# Teams通知設定 詳細手順

## 1. 通知の種類

このシステムでは以下の通知が発生します:

| タイミング | 送信先 | 通知内容 |
|-----------|--------|---------|
| 申請時 | 承認者 | 承認依頼（アダプティブカード） |
| 承認後 | 申請者 | 承認完了通知 |
| 却下後 | 申請者 | 却下通知（理由付き） |

---

## 2. 承認者への通知（アダプティブカード）

### 2.1 表示イメージ

```
┌─────────────────────────────────────────────────────┐
│  📋 資格取得申請                                     │
├─────────────────────────────────────────────────────┤
│                                                     │
│  申請者: 山田 太郎                                   │
│  種別:   資格取得宣言届                             │
│                                                     │
│  ─────────────────────────────────────────────     │
│                                                     │
│  📚 資格情報                                        │
│  ┌─────────────────────────────────────────────┐  │
│  │ 資格名: 日商簿記検定 2級                      │  │
│  │ 予定日: 2025/03/15                           │  │
│  └─────────────────────────────────────────────┘  │
│                                                     │
│  💰 報奨金                                          │
│  ┌─────────────────────────────────────────────┐  │
│  │ 基本報奨金:      ¥10,000                     │  │
│  │ 事前申請ボーナス: ¥5,000                     │  │
│  │ ───────────────────────────                 │  │
│  │ 合計:           ¥15,000                      │  │
│  └─────────────────────────────────────────────┘  │
│                                                     │
│  📝 理由                                            │
│  キャリアアップのため、簿記2級の取得を目指します。  │
│                                                     │
│  ┌───────────┐  ┌───────────┐                     │
│  │  ✓ 承認   │  │  ✗ 却下   │                     │
│  └───────────┘  └───────────┘                     │
│                                                     │
│  コメント（任意）:                                  │
│  ┌─────────────────────────────────────────────┐  │
│  │                                             │  │
│  └─────────────────────────────────────────────┘  │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2.2 承認アクションの詳細設定

Power Automateの「開始して承認を待機」アクションで自動的にアダプティブカードが生成されます。

カスタマイズしたい場合は「アダプティブカードを使用して承認」を使用:

```json
{
    "type": "AdaptiveCard",
    "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
    "version": "1.4",
    "body": [
        {
            "type": "TextBlock",
            "text": "📋 資格取得申請",
            "weight": "Bolder",
            "size": "Large"
        },
        {
            "type": "FactSet",
            "facts": [
                {
                    "title": "申請者",
                    "value": "@{triggerOutputs()?['body/申請者/DisplayName']}"
                },
                {
                    "title": "種別",
                    "value": "@{triggerOutputs()?['body/申請種別/Value']}"
                },
                {
                    "title": "資格",
                    "value": "@{triggerOutputs()?['body/取得資格/Value']}"
                },
                {
                    "title": "予定日",
                    "value": "@{formatDateTime(triggerOutputs()?['body/予定日_取得日'], 'yyyy/MM/dd')}"
                }
            ]
        },
        {
            "type": "TextBlock",
            "text": "💰 報奨金",
            "weight": "Bolder",
            "spacing": "Medium"
        },
        {
            "type": "FactSet",
            "facts": [
                {
                    "title": "基本報奨金",
                    "value": "¥@{triggerOutputs()?['body/報奨金額']}"
                },
                {
                    "title": "事前申請ボーナス",
                    "value": "¥@{triggerOutputs()?['body/事前ボーナス']}"
                },
                {
                    "title": "合計",
                    "value": "¥@{add(triggerOutputs()?['body/報奨金額'], triggerOutputs()?['body/事前ボーナス'])}"
                }
            ]
        },
        {
            "type": "TextBlock",
            "text": "📝 理由",
            "weight": "Bolder",
            "spacing": "Medium"
        },
        {
            "type": "TextBlock",
            "text": "@{triggerOutputs()?['body/理由_内容']}",
            "wrap": true
        }
    ]
}
```

---

## 3. 申請者への通知

### 3.1 承認完了通知

```
┌─────────────────────────────────────────────────────┐
│  ✅ 資格取得申請が承認されました                      │
├─────────────────────────────────────────────────────┤
│                                                     │
│  申請内容:                                          │
│  ・種別: 資格取得宣言届                             │
│  ・資格: 日商簿記検定 2級                           │
│  ・報奨金: ¥15,000                                  │
│                                                     │
│  承認者: 鈴木 一郎                                  │
│  承認日時: 2025/01/15 14:30                        │
│                                                     │
│  資格取得頑張ってください！                         │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 3.2 却下通知

```
┌─────────────────────────────────────────────────────┐
│  ❌ 資格取得申請が却下されました                      │
├─────────────────────────────────────────────────────┤
│                                                     │
│  申請内容:                                          │
│  ・種別: 資格取得宣言届                             │
│  ・資格: 日商簿記検定 2級                           │
│                                                     │
│  却下者: 鈴木 一郎                                  │
│  コメント: 現在の業務との関連性を再検討してください  │
│                                                     │
│  ご不明点があれば、承認者にお問い合わせください。    │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 4. Teams通知の設定方法

### 4.1 Flow botを使用（推奨）

Power Automateの「チャットまたはチャネルにメッセージを投稿する」アクション:

```
投稿者: Flow bot
投稿先: Chat with Flow bot
受信者: @{triggerOutputs()?['body/申請者/Email']}
```

**メリット:**
- 個人チャットに直接届く
- 見逃しにくい
- 設定が簡単

### 4.2 チャネル投稿（オプション）

特定のチャネルに投稿する場合:

```
投稿者: Flow bot
投稿先: Channel
チーム: [チーム名]
チャネル: [チャネル名]
```

**メリット:**
- 全員が申請状況を確認できる
- 透明性が高い

---

## 5. 通知のカスタマイズ

### 5.1 メンション付き通知

申請者をメンションする場合:

```html
<at>@{triggerOutputs()?['body/申請者/Email']}</at>
資格取得申請が承認されました！
```

### 5.2 リンク付き通知

SharePointの申請詳細へのリンクを含める:

```html
✅ 資格取得申請が承認されました

<a href="@{triggerOutputs()?['body/{Link}']}">申請詳細を確認</a>
```

---

## 6. 通知設定のベストプラクティス

### 6.1 推奨設定

| 項目 | 推奨 |
|------|------|
| 承認依頼 | Teamsアダプティブカード |
| 結果通知 | Flow bot個人チャット |
| 通知頻度 | 即時 |
| リマインダー | 3日後に1回 |

### 6.2 避けるべき設定

- 同じ内容を複数チャネルに投稿（通知疲れ）
- 詳細すぎる情報の記載（セキュリティ）
- リマインダーの頻度が高すぎる

---

## 7. テスト方法

### 7.1 テスト手順

1. テスト用の申請を作成
2. 承認者のTeamsで通知を確認
3. 承認/却下を実行
4. 申請者への通知を確認

### 7.2 確認ポイント

- [ ] 承認カードが正しく表示される
- [ ] 承認ボタンが機能する
- [ ] コメント入力ができる
- [ ] 結果通知が届く
- [ ] 通知内容が正確

---

## 8. トラブルシューティング

| 問題 | 解決方法 |
|------|---------|
| 通知が届かない | Teamsの通知設定を確認、Flow botがブロックされていないか確認 |
| カードが表示されない | アダプティブカードのJSON構文を確認 |
| ボタンが機能しない | Power Automateの接続を更新 |
| 文字化け | UTF-8エンコーディングを確認 |

---

## 9. セキュリティ考慮事項

### 9.1 情報の取り扱い

- 報奨金額などの情報は個人チャットのみに送信
- チャネル投稿する場合は最小限の情報のみ
- 申請理由などの詳細はリンク先で確認する形式を推奨

### 9.2 アクセス権限

- 承認カードは承認者本人のみが操作可能
- 通知内容の転送に注意喚起
