# アクション一覧

> **最終更新:** 2026年2月10日
> **ステータス:** 全Phase完了

---

## ステータス

```
Phase 0: 追加調査       ✅ 完了（2026-02-10）
Phase 1: Power Apps     ✅ 完了（2026-02-10）
Phase 2: Power Automate ✅ 完了（2026-02-10）
Phase 3: テスト         ✅ 完了（2026-02-10）
```

---

## Phase 0: 追加調査 ✅ 完了

### 調査0-1: 条件1のFalse分岐 → ✅ 確認済み

- ✅ 条件2（事前ボーナス > 0）が既に存在（パターンA確定）
- ✅ Teams通知3（ボーナスあり）が存在し、内容正常
- ✅ Teams通知4（ボーナスなし）が存在し、内容正常
- ✅ 条件2のAND空白行 → A-3で修正済み
- ✅ ステータス更新欠落 → A-5で修正済み

### 調査0-2: 項目の更新4 → ✅ 確認済み

- ✅ ステータス「申請中」→「却下」に修正済み（A-4）

---

## Phase 1: Power Apps ✅ 完了

### B-1: Dropdown1のフィルター改善 ✅

```
Filter(
    資格取得申請,
    申請種別.Value = "資格取得宣言届"
        && ステータス.Value = "承認済"
        && Title = DropdownQualification.Selected.Value & " " & DropdownDetail.Selected.Value
)
```

> **注:** Title は「資格名 + 半角スペース + 詳細（級）」の形式で保存されるため、同じ形式で比較する必要がある

### B-2: Patch関数に関連宣言届IDを追加 ✅

既存のPatch関数に以下のフィールドを追加済み:
```
関連宣言届ID: If(
    RadioApplicationType.Selected.Value = "資格取得届"
        && !IsBlank(Dropdown1.Selected),
    Dropdown1.Selected.ID,
    Blank()
)
```

---

## Phase 2: Power Automate ✅ 完了

| No. | 作業 | 状態 |
|-----|------|------|
| A-1 | 遅延アクション（10秒）追加 | ✅ |
| A-2 | 条件1のAND空白行を削除 | ✅ |
| A-3 | 条件2のAND空白行を削除 | ✅ |
| A-4 | 項目の更新4: ステータスを「却下」に変更 | ✅ |
| A-5 | 承認時ステータス更新（項目の更新3）を追加 | ✅ |
| A-6 | 承認タイトルに資格名を追加 | ✅ |

補足:
- 条件1 True 内の For each → 「項目の更新」は項目の更新3と重複していたため削除済み
- 項目の更新3の承認者Claimsは式で設定: `body('開始して承認を待機')?['responses'][0]?['responder']?['email']`

---

## Phase 3: テスト ✅ 完了

| No. | テスト内容 | 結果 |
|-----|----------|------|
| 1 | 宣言届 → 承認 | ✅ ステータス「承認済」、Teams通知OK |
| 2 | 取得届（宣言届紐づけ）→ 承認 | ✅ 報奨金+ボーナス、関連宣言届ID記録OK |
| 3 | 取得届（宣言届なし）→ 承認 | ✅ 報奨金のみ、「次回は宣言届を」メッセージOK |
| 4 | 却下 | ✅ ステータス「却下」、却下理由付き通知OK |
| 5 | SharePointデータ整合性 | ✅ 全フィールド正常 |
