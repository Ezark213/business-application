# MS経費申請アプリ 作成手順書（初心者向け）

このガイドでは、Microsoft 365で経費申請アプリを一から作成する手順を説明します。
各作業は番号順に進めてください。

---

## 目次

1. [事前準備](#1-事前準備)
2. [SharePointサイトの作成](#2-sharepointサイトの作成)
3. [SharePointリストの作成](#3-sharepointリストの作成)
4. [Power Appsアプリの作成](#4-power-appsアプリの作成)
5. [Power Automateフローの作成](#5-power-automateフローの作成)
6. [Teamsとの連携](#6-teamsとの連携)
7. [テストと公開](#7-テストと公開)

---

## 1. 事前準備

### 作業1-1: 必要なものを確認する

以下が揃っているか確認してください：

- [ ] Microsoft 365 のアカウント（会社から配布されたもの）
- [ ] ブラウザ（Edge または Chrome を推奨）
- [ ] インターネット接続

### 作業1-2: Microsoft 365 にサインインする

1. ブラウザを開く
2. アドレスバーに `https://www.office.com` と入力してEnter
3. 会社のメールアドレスを入力して「次へ」
4. パスワードを入力して「サインイン」
5. 「サインインの状態を維持しますか？」→「はい」をクリック

**確認ポイント**: 左上に「Microsoft 365」と表示されていればOK

---

## 2. SharePointサイトの作成

### 作業2-1: SharePointを開く

1. Microsoft 365 のホーム画面で、左側のメニューから「SharePoint」をクリック
2. （見つからない場合）左上の9つの点（アプリランチャー）をクリック → 「SharePoint」を選択

### 作業2-2: 新しいサイトを作成する

1. SharePointの画面で「+ サイトの作成」ボタンをクリック
2. 「チームサイト」を選択
3. 以下を入力：
   - **サイト名**: `経費管理`
   - **サイトの説明**: `経費申請を管理するサイト`
   - **プライバシー設定**: 「プライベート」を選択
4. 「次へ」をクリック
5. メンバーの追加は後でできるので「完了」をクリック

**確認ポイント**: 「経費管理」というサイトが表示されればOK

### 作業2-3: サイトのURLをメモする

1. ブラウザのアドレスバーを見る
2. `https://xxxxx.sharepoint.com/sites/経費管理` のようなURLをコピー
3. メモ帳などに保存しておく（後で使います）

---

## 3. SharePointリストの作成

### 作業3-1: 経費申請リストを作成する

1. 経費管理サイトの画面で「+ 新規」→「リスト」をクリック
2. 「空白のリスト」を選択
3. 名前に `ExpenseRequests` と入力
4. 「作成」をクリック

### 作業3-2: 列を追加する（支出日）

1. リストが表示されたら「+ 列の追加」をクリック
2. 「日付」を選択
3. 以下を設定：
   - **名前**: `支出日`
   - **この列に情報が必要ですか**: 「はい」を選択
4. 「保存」をクリック

### 作業3-3: 列を追加する（部署）

1. 「+ 列の追加」をクリック
2. 「選択肢」を選択
3. 以下を設定：
   - **名前**: `部署`
   - **選択肢**: 以下を1行ずつ入力
     ```
     営業部
     開発部
     管理部
     経理部
     人事部
     総務部
     ```
   - **この列に情報が必要ですか**: 「はい」を選択
4. 「保存」をクリック

### 作業3-4: 列を追加する（勘定科目）

1. 「+ 列の追加」をクリック
2. 「選択肢」を選択
3. 以下を設定：
   - **名前**: `勘定科目`
   - **選択肢**: 以下を1行ずつ入力
     ```
     旅費交通費
     交際費
     会議費
     通信費
     消耗品費
     新聞図書費
     水道光熱費
     地代家賃
     支払手数料
     広告宣伝費
     福利厚生費
     修繕費
     租税公課
     車両費
     雑費
     ```
4. 「保存」をクリック

### 作業3-5: 列を追加する（内容）

1. 「+ 列の追加」をクリック
2. 「1行テキスト」を選択
3. 以下を設定：
   - **名前**: `内容`
   - **この列に情報が必要ですか**: 「はい」を選択
4. 「保存」をクリック

### 作業3-6: 列を追加する（金額税込）

1. 「+ 列の追加」をクリック
2. 「通貨」を選択
3. 以下を設定：
   - **名前**: `金額税込`
   - **通貨形式**: 「¥123,456 (日本)」を選択
   - **この列に情報が必要ですか**: 「はい」を選択
4. 「保存」をクリック

### 作業3-7: 列を追加する（税区分）

1. 「+ 列の追加」をクリック
2. 「選択肢」を選択
3. 以下を設定：
   - **名前**: `税区分`
   - **選択肢**: 以下を1行ずつ入力
     ```
     10%・適格（インボイス）
     10%・区分記載
     10%・経過措置80%
     10%・経過措置50%
     8%軽減・適格（インボイス）
     8%軽減・区分記載
     8%軽減・経過措置80%
     8%軽減・経過措置50%
     非課税
     不課税
     ```
4. 「保存」をクリック

### 作業3-8: 列を追加する（消費税額）

1. 「+ 列の追加」をクリック
2. 「通貨」を選択
3. 以下を設定：
   - **名前**: `消費税額`
   - **通貨形式**: 「¥123,456 (日本)」を選択
4. 「保存」をクリック

### 作業3-9: 列を追加する（税抜金額）

1. 「+ 列の追加」をクリック
2. 「通貨」を選択
3. 以下を設定：
   - **名前**: `税抜金額`
   - **通貨形式**: 「¥123,456 (日本)」を選択
4. 「保存」をクリック

### 作業3-10: 列を追加する（インボイス番号）

1. 「+ 列の追加」をクリック
2. 「1行テキスト」を選択
3. 以下を設定：
   - **名前**: `インボイス番号`
4. 「保存」をクリック

### 作業3-11: 列を追加する（承認状況）

1. 「+ 列の追加」をクリック
2. 「選択肢」を選択
3. 以下を設定：
   - **名前**: `承認状況`
   - **選択肢**: 以下を1行ずつ入力
     ```
     下書き
     申請中
     承認済み
     差戻し
     却下
     ```
   - **既定値**: `下書き`
4. 「保存」をクリック

### 作業3-12: 列を追加する（承認者）

1. 「+ 列の追加」をクリック
2. 「ユーザー」を選択
3. 以下を設定：
   - **名前**: `承認者`
4. 「保存」をクリック

### 作業3-13: 列を追加する（承認日）

1. 「+ 列の追加」をクリック
2. 「日付と時刻」を選択
3. 以下を設定：
   - **名前**: `承認日`
4. 「保存」をクリック

### 作業3-14: 列を追加する（承認コメント）

1. 「+ 列の追加」をクリック
2. 「複数行テキスト」を選択
3. 以下を設定：
   - **名前**: `承認コメント`
4. 「保存」をクリック

### 作業3-15: 承認者マスタリストを作成する

1. サイトのホームに戻る（左上の「経費管理」をクリック）
2. 「+ 新規」→「リスト」をクリック
3. 「空白のリスト」を選択
4. 名前に `Approvers` と入力
5. 「作成」をクリック

### 作業3-16: 承認者マスタに列を追加する

以下の列を追加してください：

| 列名 | 種類 | 設定 |
|------|------|------|
| 部署 | 選択肢 | 営業部/開発部/管理部/経理部/人事部/総務部 |
| 第一承認者 | ユーザー | 必須 |
| 第二承認者 | ユーザー | （任意） |
| 上限金額 | 通貨 | 既定値: 50000 |

### 作業3-17: 承認者データを登録する

1. Approversリストで「+ 新しいアイテム」をクリック
2. 各部署の承認者を登録
   - 部署: 営業部
   - 第一承認者: （部長のメールアドレスを検索して選択）
   - 第二承認者: （必要なら追加）
   - 上限金額: 50000
3. 「保存」をクリック
4. 他の部署も同様に登録

---

## 4. Power Appsアプリの作成

### 作業4-1: Power Appsを開く

1. ブラウザの新しいタブを開く
2. アドレスバーに `https://make.powerapps.com` と入力してEnter
3. 会社のアカウントでサインイン

### 作業4-2: アプリを新規作成する

1. 左側メニューの「+ 作成」をクリック
2. 「空のアプリ」をクリック
3. 「空のキャンバスアプリ」の「作成」をクリック
4. 以下を入力：
   - **アプリ名**: `経費申請アプリ`
   - **形式**: 「タブレット」を選択
5. 「作成」をクリック

### 作業4-3: SharePointリストに接続する

1. 左側の「データ」アイコン（円柱のマーク）をクリック
2. 「+ データの追加」をクリック
3. 検索ボックスに `SharePoint` と入力
4. 「SharePoint」を選択
5. 「直接接続（クラウドサービス）」を選択して「接続」
6. SharePointサイトのURLを入力（作業2-3でメモしたもの）
7. 「接続」をクリック
8. `ExpenseRequests` にチェックを入れる
9. `Approvers` にチェックを入れる
10. 「接続」をクリック

### 作業4-4: 一覧画面を作成する

1. 左側の「挿入」タブをクリック
2. 「垂直ギャラリー」をクリック
3. 画面に配置されたギャラリーを選択
4. 右側の「データソース」で `ExpenseRequests` を選択
5. ギャラリーのサイズを画面いっぱいに調整

### 作業4-5: ギャラリーの表示項目を設定する

1. ギャラリーを選択した状態で
2. 右側パネルの「フィールド」→「編集」をクリック
3. 以下を設定：
   - **Title1**: 内容
   - **Subtitle1**: 勘定科目
   - **Body1**: 金額税込

### 作業4-6: 申請フォーム画面を追加する

1. 左側の「ツリービュー」で「新しい画面」→「フォーム」をクリック
2. 追加されたフォームを選択
3. 右側パネルの「データソース」で `ExpenseRequests` を選択
4. 「フィールドの編集」で表示する項目を選択

### 作業4-7: ナビゲーションを設定する

1. Screen1（一覧画面）に戻る
2. 「挿入」→「ボタン」をクリック
3. ボタンのテキストを `新規申請` に変更
4. ボタンを選択して、上部の「OnSelect」に以下を入力：
   ```
   Navigate(Screen2)
   ```

### 作業4-8: アプリを保存する

1. 右上の「保存」アイコン（ディスクのマーク）をクリック
2. または Ctrl + S を押す

**ここまでで基本的なアプリの形ができました！**

---

## 5. Power Automateフローの作成

### 作業5-1: Power Automateを開く

1. ブラウザの新しいタブを開く
2. アドレスバーに `https://make.powerautomate.com` と入力してEnter

### 作業5-2: 承認フローを作成する

1. 左側メニューの「+ 作成」をクリック
2. 「自動クラウドフロー」をクリック
3. 以下を入力：
   - **フロー名**: `経費申請承認フロー`
   - **トリガー**: 検索ボックスに `SharePoint` と入力
   - 「アイテムが作成または変更されたとき」を選択
4. 「作成」をクリック

### 作業5-3: トリガーを設定する

1. 「アイテムが作成または変更されたとき」のボックスをクリック
2. 以下を設定：
   - **サイトのアドレス**: ドロップダウンから「経費管理」を選択
   - **リスト名**: `ExpenseRequests` を選択

### 作業5-4: 条件を追加する

1. 「+ 新しいステップ」をクリック
2. 「条件」を検索して選択
3. 条件を設定：
   - 左側: 「承認状況」を選択（動的なコンテンツから）
   - 中央: 「次の値に等しい」
   - 右側: `申請中` と入力

### 作業5-5: 承認アクションを追加する（「はい」の場合）

1. 「はい」の分岐内で「アクションの追加」をクリック
2. `承認` を検索
3. 「開始して承認を待機」を選択
4. 以下を設定：
   - **承認の種類**: 「承認/拒否 - 最初に応答」
   - **タイトル**: `経費申請の承認依頼`
   - **担当者**: 承認者のメールアドレス（動的コンテンツから選択）
   - **詳細**: 申請内容の詳細を設定

### 作業5-6: 承認結果でSharePointを更新する

1. 承認アクションの後に「条件」を追加
2. 条件: 「結果」が「Approve」に等しい
3. 「はい」の場合:
   - 「SharePoint - 項目の更新」を追加
   - 承認状況を「承認済み」に更新
4. 「いいえ」の場合:
   - 「SharePoint - 項目の更新」を追加
   - 承認状況を「却下」に更新

### 作業5-7: フローを保存してテストする

1. 右上の「保存」をクリック
2. 「テスト」をクリック
3. 「手動」を選択して「テスト」
4. SharePointリストで新しいアイテムを「申請中」で作成
5. フローが動作することを確認

---

## 6. Teamsとの連携

### 作業6-1: Teams通知フローを作成する

1. Power Automateで「+ 作成」→「自動クラウドフロー」
2. フロー名: `経費申請Teams通知`
3. トリガー: 「アイテムが作成または変更されたとき (SharePoint)」

### 作業6-2: Teams通知アクションを追加する

1. 「+ 新しいステップ」をクリック
2. `Teams` を検索
3. 「チャットまたはチャネルでメッセージを投稿する」を選択
4. 以下を設定：
   - **投稿先**: 「Channel」
   - **チーム**: 通知先のチームを選択
   - **チャネル**: 通知先のチャネルを選択
   - **メッセージ**: 申請内容を設定

### 作業6-3: Power AppsをTeamsに追加する

1. Teamsを開く
2. 左側の「アプリ」をクリック
3. 「Power Apps」を検索して追加
4. チャネルのタブに「経費申請アプリ」を追加

---

## 7. テストと公開

### 作業7-1: テストデータを登録する

1. SharePointの ExpenseRequests リストを開く
2. 「+ 新しいアイテム」をクリック
3. テストデータを入力して保存

### 作業7-2: Power Appsでテストする

1. Power Appsエディタで「▶」ボタンをクリック
2. アプリをプレビューモードで操作
3. データの表示、登録、編集ができることを確認

### 作業7-3: 承認フローをテストする

1. Power Appsまたは SharePoint で新規申請を作成
2. 承認状況を「申請中」に設定
3. 承認者にメール/Teams通知が届くことを確認
4. 承認者が承認/却下できることを確認

### 作業7-4: アプリを公開する

1. Power Appsエディタで右上の「公開」をクリック
2. 「このバージョンの公開」をクリック

### 作業7-5: ユーザーとアプリを共有する

1. Power Apps の「アプリ」画面を開く
2. 「経費申請アプリ」の「...」→「共有」をクリック
3. 共有したいユーザーやグループを追加
4. 「共有」をクリック

---

## トラブルシューティング

### よくある問題と解決方法

| 問題 | 解決方法 |
|------|----------|
| SharePointリストが表示されない | データソースを再接続する |
| フローが動作しない | フローの実行履歴でエラーを確認 |
| Power Appsでデータが保存されない | フォームのモードが「Edit」か確認 |
| Teams通知が届かない | チャネルの設定とフローの設定を確認 |

---

## チェックリスト

作業完了後、以下を確認してください：

- [ ] SharePointサイトが作成された
- [ ] ExpenseRequestsリストに必要な列がすべてある
- [ ] Approversリストに承認者データが登録された
- [ ] Power Appsで経費の一覧表示ができる
- [ ] Power Appsで新規申請ができる
- [ ] 申請すると承認フローが動作する
- [ ] 承認/却下するとSharePointが更新される
- [ ] Teamsに通知が届く

---

## 次のステップ

基本機能ができたら、以下の機能を追加できます：

1. 税額自動計算の実装
2. 領収書添付機能の追加
3. レポート画面の作成
4. 会計ソフト連携（Excelエクスポート）

詳細は `architecture.md` を参照してください。
