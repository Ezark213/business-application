<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M365 経費申請アプリ構築手順書</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'Yu Gothic UI', 'Meiryo', sans-serif; line-height: 1.8; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        header { background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%); color: white; padding: 40px; text-align: center; }
        header h1 { font-size: 2em; margin-bottom: 10px; }
        header p { opacity: 0.9; font-size: 1.1em; }
        .content { padding: 40px; }
        .overview { background: #f8f9fa; border-radius: 15px; padding: 25px; margin-bottom: 30px; border-left: 5px solid #0078d4; }
        .overview h2 { color: #0078d4; margin-bottom: 15px; }
        .step { background: white; border: 1px solid #e0e0e0; border-radius: 15px; margin-bottom: 25px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .step-header { background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%); color: white; padding: 20px 25px; display: flex; align-items: center; gap: 15px; }
        .step-number { background: white; color: #0078d4; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.3em; flex-shrink: 0; }
        .step-title { font-size: 1.3em; font-weight: 600; }
        .step-content { padding: 25px; }
        .substep { background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 4px solid #28a745; }
        .substep h4 { color: #28a745; margin-bottom: 10px; }
        .substep ol, .substep ul { margin-left: 25px; }
        .substep li { margin-bottom: 8px; }
        .info-box { background: #e7f3ff; border: 1px solid #0078d4; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .info-box-title { color: #0078d4; font-weight: bold; margin-bottom: 8px; }
        .highlight { background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .highlight-title { color: #856404; font-weight: bold; margin-bottom: 8px; }
        .csv-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9em; }
        .csv-table th { background: #0078d4; color: white; padding: 12px; text-align: left; }
        .csv-table td { border: 1px solid #ddd; padding: 10px; }
        .csv-table tr:nth-child(even) { background: #f8f9fa; }
        .checklist { background: #d4edda; border-radius: 10px; padding: 20px; margin: 20px 0; }
        .checklist h4 { color: #155724; margin-bottom: 15px; }
        .checklist label { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer; }
        .checklist input[type="checkbox"] { width: 20px; height: 20px; }
        .code-block { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; overflow-x: auto; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9em; margin: 10px 0; }
        .warning { background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .warning-title { color: #721c24; font-weight: bold; margin-bottom: 8px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .success-title { color: #155724; font-weight: bold; margin-bottom: 8px; }
        footer { background: #f8f9fa; padding: 30px; text-align: center; border-top: 1px solid #e0e0e0; }
        /* Power Apps UI Mockup */
        .app-mockup { background: #f3f2f1; border-radius: 12px; margin: 20px 0; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
        .app-header { background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .app-header h3 { margin: 0; font-size: 1.2em; }
        .app-user { display: flex; align-items: center; gap: 8px; font-size: 0.9em; }
        .app-user-icon { width: 32px; height: 32px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #0078d4; font-weight: bold; }
        .app-body { padding: 20px; background: white; }
        .app-nav { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .app-nav-btn { background: #0078d4; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-size: 0.9em; }
        .app-nav-btn.secondary { background: #6c757d; }
        .app-nav-btn.success { background: #28a745; }
        .app-nav-btn.warning { background: #ffc107; color: #333; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 0.9em; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1em; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .calculated-field { background: #e7f3ff; padding: 10px; border-radius: 6px; border: 1px solid #0078d4; }
        .app-footer { background: #f3f2f1; padding: 15px 20px; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #ddd; }
        .btn-submit { background: #0078d4; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 1em; }
        .btn-cancel { background: #6c757d; color: white; border: none; padding: 12px 30px; border-radius: 6px; font-size: 1em; }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; font-weight: 600; }
        .status-draft { background: #6c757d; color: white; }
        .status-pending { background: #ffc107; color: #333; }
        .status-approved { background: #28a745; color: white; }
        .detail-list { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; margin: 15px 0; }
        .detail-list-header { background: #f8f9fa; padding: 10px 15px; font-weight: 600; display: grid; grid-template-columns: 90px 1fr 100px 80px 60px; gap: 10px; font-size: 0.8em; border-bottom: 1px solid #ddd; }
        .detail-list-item { padding: 10px 15px; display: grid; grid-template-columns: 90px 1fr 100px 80px 60px; gap: 10px; border-bottom: 1px solid #eee; font-size: 0.85em; align-items: center; }
        .detail-list-item:last-child { border-bottom: none; }
        .detail-list-total { background: #e7f3ff; padding: 12px 15px; font-weight: 600; display: flex; justify-content: space-between; }
        .request-list { border: 1px solid #ddd; border-radius: 8px; overflow: hidden; }
        .request-list-header { background: #f8f9fa; padding: 12px 15px; font-weight: 600; display: grid; grid-template-columns: 90px 1fr 80px 100px 80px; gap: 10px; font-size: 0.85em; border-bottom: 1px solid #ddd; }
        .request-list-item { padding: 12px 15px; display: grid; grid-template-columns: 90px 1fr 80px 100px 80px; gap: 10px; border-bottom: 1px solid #eee; font-size: 0.9em; align-items: center; }
        .request-list-item:hover { background: #f8f9fa; }
        .data-structure { display: flex; gap: 20px; flex-wrap: wrap; margin: 20px 0; }
        .data-box { flex: 1; min-width: 250px; border: 2px solid #0078d4; border-radius: 10px; overflow: hidden; }
        .data-box-header { background: #0078d4; color: white; padding: 10px 15px; font-weight: 600; }
        .data-box-content { padding: 15px; font-size: 0.9em; }
        .data-box-content ul { margin-left: 20px; }
        .arrow-container { display: flex; align-items: center; justify-content: center; font-size: 2em; color: #0078d4; }
        @media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } .data-structure { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>M365 経費申請アプリ構築手順書</h1>
            <p>複数経費をまとめて申請できる設計</p>
        </header>

        <div class="content">
            <!-- 概要 -->
            <div class="overview">
                <h2>この手順書について</h2>
                <p>この手順書では、Microsoft 365環境で動作する経費申請システムの構築手順を解説します。<br>
                <strong>本システムは「複数の経費をまとめて1回で申請」する設計です。</strong></p>
            </div>

            <!-- データ構造の説明 -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">DB</div>
                    <div class="step-title">データ構造（ヘッダー・明細方式）</div>
                </div>
                <div class="step-content">
                    <p>本システムは「申請ヘッダー」と「経費明細」の2つのリストで構成されます。</p>

                    <div class="data-structure">
                        <div class="data-box">
                            <div class="data-box-header">ExpenseRequests（申請ヘッダー）</div>
                            <div class="data-box-content">
                                <p><strong>1申請 = 1レコード</strong></p>
                                <ul>
                                    <li>申請者</li>
                                    <li>申請日</li>
                                    <li>部署</li>
                                    <li>明細件数</li>
                                    <li>合計金額（税込/税額/税抜）</li>
                                    <li>承認ステータス</li>
                                    <li>承認者/承認日時</li>
                                </ul>
                            </div>
                        </div>
                        <div class="arrow-container">→</div>
                        <div class="data-box">
                            <div class="data-box-header">ExpenseDetails（経費明細）</div>
                            <div class="data-box-content">
                                <p><strong>1経費 = 1レコード</strong></p>
                                <ul>
                                    <li>申請ID（参照）</li>
                                    <li>経費日付</li>
                                    <li>勘定科目</li>
                                    <li>内容</li>
                                    <li>税込金額/税区分</li>
                                    <li>税額/税抜金額</li>
                                    <li>インボイス番号</li>
                                    <li>領収書</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="highlight">
                        <div class="highlight-title">運用フロー</div>
                        <ol>
                            <li>申請者が「新規申請」を作成（ExpenseRequestsに1レコード作成）</li>
                            <li>経費を1件ずつ追加（ExpenseDetailsに複数レコード作成）</li>
                            <li>すべての経費を入力したら「申請する」ボタンで一括申請</li>
                            <li>承認者は申請単位で承認/却下</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Power Apps 完成イメージ -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">UI</div>
                    <div class="step-title">Power Apps 完成イメージ</div>
                </div>
                <div class="step-content">
                    <!-- 申請作成・明細追加画面 -->
                    <div class="info-box">
                        <div class="info-box-title">申請作成画面（ExpenseFormScreen）</div>
                        <p>経費を追加しながら申請を作成する画面</p>
                    </div>
                    <div class="app-mockup">
                        <div class="app-header">
                            <h3>経費申請 - 新規作成</h3>
                            <div class="app-user"><span>山田 太郎</span><div class="app-user-icon">山</div></div>
                        </div>
                        <div class="app-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>申請日</label>
                                    <input type="date" value="2026-01-19">
                                </div>
                                <div class="form-group">
                                    <label>部署</label>
                                    <input type="text" value="営業部">
                                </div>
                            </div>

                            <h4 style="margin: 20px 0 10px; color: #0078d4;">経費明細</h4>
                            <div class="detail-list">
                                <div class="detail-list-header">
                                    <span>日付</span>
                                    <span>内容</span>
                                    <span>勘定科目</span>
                                    <span>金額</span>
                                    <span>操作</span>
                                </div>
                                <div class="detail-list-item">
                                    <span>01/15</span>
                                    <span>東京-大阪 新幹線</span>
                                    <span>交通費</span>
                                    <span>27,500円</span>
                                    <span style="color: #dc3545; cursor: pointer;">削除</span>
                                </div>
                                <div class="detail-list-item">
                                    <span>01/16</span>
                                    <span>取引先との会食</span>
                                    <span>接待交際費</span>
                                    <span>15,400円</span>
                                    <span style="color: #dc3545; cursor: pointer;">削除</span>
                                </div>
                                <div class="detail-list-item">
                                    <span>01/17</span>
                                    <span>タクシー代</span>
                                    <span>交通費</span>
                                    <span>2,800円</span>
                                    <span style="color: #dc3545; cursor: pointer;">削除</span>
                                </div>
                                <div class="detail-list-total">
                                    <span>合計 3件</span>
                                    <span>45,700円</span>
                                </div>
                            </div>

                            <button class="app-nav-btn warning" style="margin-top: 10px;">+ 経費を追加</button>
                        </div>
                        <div class="app-footer">
                            <button class="btn-cancel">下書き保存</button>
                            <button class="btn-submit">申請する</button>
                        </div>
                    </div>

                    <!-- 経費追加モーダル -->
                    <div class="info-box">
                        <div class="info-box-title">経費追加画面（モーダル/別画面）</div>
                    </div>
                    <div class="app-mockup">
                        <div class="app-header">
                            <h3>経費を追加</h3>
                            <div class="app-user"><span>山田 太郎</span><div class="app-user-icon">山</div></div>
                        </div>
                        <div class="app-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>経費日付 *</label>
                                    <input type="date" value="2026-01-18">
                                </div>
                                <div class="form-group">
                                    <label>勘定科目 *</label>
                                    <select>
                                        <option>会議費</option>
                                        <option>交際費</option>
                                        <option>旅費交通費</option>
                                        <option>通信費</option>
                                        <option>消耗品費</option>
                                        <option>諸会費</option>
                                        <option>保険料</option>
                                        <option>租税公課</option>
                                        <option>支払手数料</option>
                                        <option>新聞図書費</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>内容 *</label>
                                <input type="text" placeholder="例：東京-大阪 新幹線往復">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>税込金額 *</label>
                                    <input type="text" value="3,300">
                                </div>
                                <div class="form-group">
                                    <label>税区分 *</label>
                                    <select>
                                        <option>10%・適格（インボイス）</option>
                                        <option>10%・区分記載（経過措置80%）</option>
                                        <option>10%・区分記載（経過措置50%）</option>
                                        <option>8%（軽減税率）・適格（インボイス）</option>
                                        <option>8%（軽減税率）・区分記載（経過措置80%）</option>
                                        <option>8%（軽減税率）・区分記載（経過措置50%）</option>
                                        <option>非課税</option>
                                        <option>不課税</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>税額（自動計算）</label>
                                    <div class="calculated-field">300 円</div>
                                </div>
                                <div class="form-group">
                                    <label>税抜金額（自動計算）</label>
                                    <div class="calculated-field">3,000 円</div>
                                </div>
                            </div>
                        </div>
                        <div class="app-footer">
                            <button class="btn-cancel">キャンセル</button>
                            <button class="btn-submit">追加</button>
                        </div>
                    </div>

                    <!-- 申請一覧画面 -->
                    <div class="info-box">
                        <div class="info-box-title">申請一覧画面（ExpenseListScreen）</div>
                    </div>
                    <div class="app-mockup">
                        <div class="app-header">
                            <h3>経費申請 - 申請一覧</h3>
                            <div class="app-user"><span>山田 太郎</span><div class="app-user-icon">山</div></div>
                        </div>
                        <div class="app-body">
                            <div class="app-nav">
                                <button class="app-nav-btn">新規申請</button>
                            </div>
                            <div class="request-list">
                                <div class="request-list-header">
                                    <span>申請日</span>
                                    <span>申請者</span>
                                    <span>件数</span>
                                    <span>合計金額</span>
                                    <span>ステータス</span>
                                </div>
                                <div class="request-list-item">
                                    <span>2026/01/19</span>
                                    <span>山田 太郎</span>
                                    <span>3件</span>
                                    <span>45,700円</span>
                                    <span class="status-badge status-pending">申請中</span>
                                </div>
                                <div class="request-list-item">
                                    <span>2026/01/10</span>
                                    <span>山田 太郎</span>
                                    <span>5件</span>
                                    <span>82,300円</span>
                                    <span class="status-badge status-approved">承認済み</span>
                                </div>
                                <div class="request-list-item">
                                    <span>2026/01/05</span>
                                    <span>山田 太郎</span>
                                    <span>2件</span>
                                    <span>12,500円</span>
                                    <span class="status-badge status-draft">下書き</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 準備済みファイル -->
            <div class="info-box">
                <div class="info-box-title">準備済みCSVファイル（3つ）</div>
                <ul>
                    <li><strong>ExpenseRequests.csv</strong> - 申請ヘッダー用</li>
                    <li><strong>ExpenseDetails.csv</strong> - 経費明細用</li>
                    <li><strong>TaxRates.csv</strong> - 税区分マスター（8パターン）</li>
                </ul>
            </div>

            <!-- ステップ0：前提条件 -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">0</div>
                    <div class="step-title">前提条件の確認</div>
                </div>
                <div class="step-content">
                    <div class="checklist">
                        <h4>以下の項目を確認してください</h4>
                        <label><input type="checkbox"> Microsoft 365 Business Basic 以上のライセンス</label>
                        <label><input type="checkbox"> Power Apps / Power Automate へのアクセス権限</label>
                        <label><input type="checkbox"> SharePoint サイト作成権限</label>
                    </div>
                </div>
            </div>

            <!-- ステップ1：SharePointサイト作成 -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">SharePoint サイトの作成</div>
                </div>
                <div class="step-content">
                    <div class="substep">
                        <h4>1-1. サイトを作成</h4>
                        <ol>
                            <li><a href="https://www.office.com" target="_blank">office.com</a> → SharePoint</li>
                            <li>「+ サイトの作成」→「チーム サイト」</li>
                            <li>サイト名：<strong>経費管理</strong></li>
                            <li>プライバシー：プライベート（推奨）</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- ステップ2：SharePointリスト作成 -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">SharePoint リストの作成（3つ）</div>
                </div>
                <div class="step-content">
                    <div class="substep">
                        <h4>2-1. TaxRates（税区分マスター）</h4>
                        <ol>
                            <li>「+ 新規」→「リスト」→「Excel から」</li>
                            <li><strong>TaxRates.csv</strong> をアップロード</li>
                        </ol>
                        <table class="csv-table">
                            <tr><th>税区分</th><th>税率</th><th>控除割合</th></tr>
                            <tr><td>10%・適格（インボイス）</td><td>10.00%</td><td>100.00%</td></tr>
                            <tr><td>10%・区分記載（経過措置80%）</td><td>10.00%</td><td>80.00%</td></tr>
                            <tr><td>10%・区分記載（経過措置50%）</td><td>10.00%</td><td>50.00%</td></tr>
                            <tr><td>8%（軽減税率）・適格（インボイス）</td><td>8.00%</td><td>100.00%</td></tr>
                            <tr><td>8%（軽減税率）・区分記載（経過措置80%）</td><td>8.00%</td><td>80.00%</td></tr>
                            <tr><td>8%（軽減税率）・区分記載（経過措置50%）</td><td>8.00%</td><td>50.00%</td></tr>
                            <tr><td>非課税</td><td>0.00%</td><td>-</td></tr>
                            <tr><td>不課税</td><td>0.00%</td><td>-</td></tr>
                        </table>
                    </div>

                    <div class="substep">
                        <h4>2-2. ExpenseRequests（申請ヘッダー）</h4>
                        <ol>
                            <li>「+ 新規」→「リスト」→「Excel から」</li>
                            <li><strong>ExpenseRequests.csv</strong> をアップロード</li>
                        </ol>
                        <table class="csv-table">
                            <tr><th>列名</th><th>データ型</th><th>説明</th></tr>
                            <tr><td>申請者</td><td>ユーザー</td><td>必須</td></tr>
                            <tr><td>申請日</td><td>日付</td><td>必須</td></tr>
                            <tr><td>部署</td><td>1行テキスト</td><td>-</td></tr>
                            <tr><td>明細件数</td><td>数値</td><td>自動計算</td></tr>
                            <tr><td>合計金額（税込）</td><td>通貨</td><td>自動計算</td></tr>
                            <tr><td>合計税額</td><td>通貨</td><td>自動計算</td></tr>
                            <tr><td>合計金額（税抜）</td><td>通貨</td><td>自動計算</td></tr>
                            <tr><td>承認ステータス</td><td>選択肢</td><td>下書き/申請中/承認済み/差戻し/却下</td></tr>
                            <tr><td>承認者</td><td>ユーザー</td><td>-</td></tr>
                            <tr><td>承認日時</td><td>日付と時刻</td><td>-</td></tr>
                        </table>
                    </div>

                    <div class="substep">
                        <h4>2-3. ExpenseDetails（経費明細）</h4>
                        <ol>
                            <li>「+ 新規」→「リスト」→「Excel から」</li>
                            <li><strong>ExpenseDetails.csv</strong> をアップロード</li>
                            <li>「申請ID」列を<strong>参照（Lookup）</strong>型に変更し、ExpenseRequestsリストを参照</li>
                        </ol>
                        <table class="csv-table">
                            <tr><th>列名</th><th>データ型</th><th>説明</th></tr>
                            <tr><td>申請ID</td><td>参照（ExpenseRequests）</td><td>★重要：リンク設定</td></tr>
                            <tr><td>経費日付</td><td>日付</td><td>必須</td></tr>
                            <tr><td>勘定科目</td><td>選択肢</td><td>会議費/交際費/旅費交通費/通信費/消耗品費/諸会費/保険料/租税公課/支払手数料/新聞図書費</td></tr>
                            <tr><td>内容</td><td>1行テキスト</td><td>必須</td></tr>
                            <tr><td>税込金額</td><td>通貨</td><td>必須</td></tr>
                            <tr><td>税区分</td><td>参照（TaxRates）</td><td>-</td></tr>
                            <tr><td>税額</td><td>通貨</td><td>自動計算</td></tr>
                            <tr><td>税抜金額</td><td>通貨</td><td>自動計算</td></tr>
                            <tr><td>インボイス番号</td><td>1行テキスト</td><td>-</td></tr>
                            <tr><td>領収書</td><td>添付ファイル</td><td>-</td></tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ステップ3：Power Apps -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">Power Apps でアプリを作成</div>
                </div>
                <div class="step-content">
                    <div class="substep">
                        <h4>3-1. アプリ作成</h4>
                        <ol>
                            <li><a href="https://make.powerapps.com" target="_blank">make.powerapps.com</a> にアクセス</li>
                            <li>「+ 作成」→「空のキャンバスアプリ」</li>
                            <li>アプリ名：<strong>経費申請アプリ</strong></li>
                        </ol>
                    </div>

                    <div class="substep">
                        <h4>3-2. データ接続（3リスト）</h4>
                        <ol>
                            <li>「データ」→「+ データの追加」→「SharePoint」</li>
                            <li>以下の3つのリストを接続：
                                <ul>
                                    <li>ExpenseRequests</li>
                                    <li>ExpenseDetails</li>
                                    <li>TaxRates</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <div class="substep">
                        <h4>3-3. 画面構成</h4>
                        <table class="csv-table">
                            <tr><th>画面名</th><th>役割</th></tr>
                            <tr><td>HomeScreen</td><td>ホーム画面（ナビゲーション）</td></tr>
                            <tr><td>ExpenseFormScreen</td><td>申請作成・明細追加</td></tr>
                            <tr><td>DetailFormScreen</td><td>経費明細入力フォーム</td></tr>
                            <tr><td>ExpenseListScreen</td><td>申請一覧</td></tr>
                            <tr><td>ApprovalScreen</td><td>承認管理</td></tr>
                        </table>
                    </div>

                    <div class="substep">
                        <h4>3-4. 合計金額の計算式（Power Fx）</h4>
                        <div class="code-block">
// 明細の合計を申請ヘッダーに反映
UpdateIf(
    ExpenseRequests,
    ID = varCurrentRequestID,
    {
        '明細件数': CountRows(Filter(ExpenseDetails, 申請ID.Id = varCurrentRequestID)),
        '合計金額（税込）': Sum(Filter(ExpenseDetails, 申請ID.Id = varCurrentRequestID), 税込金額),
        '合計税額': Sum(Filter(ExpenseDetails, 申請ID.Id = varCurrentRequestID), 税額),
        '合計金額（税抜）': Sum(Filter(ExpenseDetails, 申請ID.Id = varCurrentRequestID), 税抜金額)
    }
)
                        </div>
                    </div>
                </div>
            </div>

            <!-- ステップ4：Power Automate -->
            <div class="step">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">Power Automate で承認フロー作成</div>
                </div>
                <div class="step-content">
                    <div class="substep">
                        <h4>4-1. フロー作成</h4>
                        <ol>
                            <li><a href="https://make.powerautomate.com" target="_blank">make.powerautomate.com</a></li>
                            <li>「+ 作成」→「自動化したクラウドフロー」</li>
                            <li>トリガー：「SharePoint - 項目が変更されたとき」</li>
                            <li>リスト：<strong>ExpenseRequests</strong></li>
                        </ol>
                    </div>

                    <div class="substep">
                        <h4>4-2. 承認アクション</h4>
                        <ol>
                            <li>条件：承認ステータス = 申請中</li>
                            <li>「開始して承認を待機」アクション追加</li>
                            <li>承認結果に応じてステータス更新</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- まとめ -->
            <div class="overview" style="border-left-color: #28a745;">
                <h2 style="color: #28a745;">構築完了後の構成</h2>
                <table class="csv-table">
                    <tr><th>コンポーネント</th><th>役割</th></tr>
                    <tr><td>SharePoint Lists</td><td>ExpenseRequests（申請）、ExpenseDetails（明細）、TaxRates（税区分）</td></tr>
                    <tr><td>Power Apps</td><td>申請作成・明細追加・一覧表示</td></tr>
                    <tr><td>Power Automate</td><td>承認ワークフロー・通知</td></tr>
                </table>
            </div>

            <div class="info-box">
                <div class="info-box-title">参考リンク</div>
                <ul>
                    <li><a href="https://github.com/Ezark213/business-application/tree/main/ms-expense-app" target="_blank">ms-expense-app リポジトリ</a></li>
                    <li><a href="https://learn.microsoft.com/ja-jp/power-apps/" target="_blank">Power Apps ドキュメント</a></li>
                </ul>
            </div>
        </div>

        <footer>
            <p>M365 経費申請アプリ構築手順書 | 作成日: 2026年1月19日</p>
        </footer>
    </div>
</body>
</html>
